<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lesson 18 — Typedef and Standard I/O Quiz</title>
<style>
  :root {
    --bg: #0a0c10; --text: #e0e0e0; --muted: #888; --border: #2a2f38;
    --accent: #3498db; --correct: #2ecc71; --wrong: #e74c3c;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: var(--bg); color: var(--text); line-height: 1.6;
    margin: 0; padding: 20px;
  }
  main { max-width: 700px; margin: 0 auto; }
  header { text-align: center; margin-bottom: 2rem; }
  h1 { color: var(--accent); }
  .subtitle { color: var(--muted); }
  .card { background: #0f1318; border: 1px solid var(--border); border-radius: 12px; padding: 24px; }
  .footer { text-align: center; padding: 28px 12px 36px; color: var(--muted); font-size: .9rem; }
  .kbd { border: 1px solid var(--border); background: #0d1218; border-bottom: 3px solid #192433; padding: 1px 6px; border-radius: 6px; }
  button {
    cursor: pointer; background: #1a2028; color: var(--text); border: 1px solid var(--border);
    border-radius: 10px; padding: 10px 16px; font-size: 1rem; transition: all .2s ease;
  }
  button:hover { border-color: var(--accent); }
  button:disabled { cursor: not-allowed; opacity: 0.5; }
  .btn-primary { background: linear-gradient(180deg, #152032, #0f1723); }
  
  /* Quiz specific styles */
  #quiz-container { min-height: 250px; }
  .question-header { margin-bottom: 1rem; display: flex; justify-content: space-between; color: var(--muted); }
  .question-body { margin-bottom: 1.5rem; font-size: 1.1rem; }
  .answers { display: grid; gap: 10px; }
  .answer {
    padding: 12px 14px; border-radius: 10px; background: #0d1218;
    border: 1px solid var(--border); cursor: pointer; transition: all .2s ease;
  }
  .answer input { margin-right: 10px; }
  .answer.correct { border-color: rgba(46, 204, 113, .6); background: rgba(46, 204, 113, .1); }
  .answer.wrong { border-color: rgba(255, 107, 107, .6); background: rgba(255, 107, 107, .08); }
  .answer.selected { border-color: var(--accent); }
  .explanation { margin-top: 12px; color: var(--muted); font-size: .92rem; border-left: 3px solid var(--border); padding-left: 12px; }
  #quiz-controls { margin-top: 20px; display: flex; gap: 12px; }
  #result-container { text-align: center; }
</style>
</head>
<body>
<header>
  <h1>Lesson 18 — Typedef and Standard I/O</h1>
  <div class="subtitle">Self-check quiz to test your understanding of type definitions and file operations.</div>
</header>

<main>
  <section class="card" aria-labelledby="quizTitle">
    <h2 id="quizTitle" style="display:none;">Interactive Quiz</h2>
    <div id="quiz-container"></div>
    <div id="quiz-controls">
      <button id="submit-btn" class="btn-primary">Submit Answer</button>
      <button id="retry-btn" style="display:none;">Try Again</button>
    </div>
  </section>
</main>

<div class="footer">
  <a href="#" id="back-link" style="color:var(--accent); display:none;">← Back to index</a>
  Keyboard: <span class="kbd">N</span> Next/Submit · <span class="kbd">R</span> Retry
</div>

<script>
const QUESTION_BANK = [
  {
    id: 'typedef-purpose',
    q: 'What is the primary purpose of the `typedef` keyword in C as explained in the lesson?',
    choices: [
      'To declare a new variable with a specific memory size.',
      'To create an alias, or a new name, for an existing data type.',
      'To define a function that returns a custom type.',
      'To create a preprocessor macro for text replacement.'
    ],
    correct: 1,
    explain: 'The transcript states that `typedef` allows you to define an alias for a type. For example, `error_code` becomes an alias for `int`[cite: 20].'
  },
  {
    id: 'typedef-struct-declaration',
    q: 'Given the definition `typedef struct { int n; int d; } fract;`, how do you correctly declare a variable `f` of this type?',
    choices: [
      '`struct fract f;`',
      '`fract f;`',
      '`typedef f;`',
      '`fract { f.n = 1; f.d = 2; };`'
    ],
    correct: 1,
    explain: 'Using `typedef` creates a type name that can be used directly, just like built-in types such as `int`[cite: 32]. [cite_start]You no longer need the `struct` keyword for declaration[cite: 34].'
  },
  {
    id: 'fopen-failure',
    q: 'When using the `fopen` function from `stdio.h`, what value is returned to indicate that the file could not be opened?',
    choices: [
      'The integer `-1`',
      'The integer `0`',
      'A pointer to an empty struct',
      'The special pointer value `NULL`'
    ],
    correct: 3,
    explain: 'The transcript and the code example both explicitly state that if the file does not exist or cannot be opened, `fopen` returns `NULL`[cite: 57, 59].'
  },
  {
    id: 'file-type-representation',
    q: 'In the C standard I/O library, what does the type `FILE` (as in `FILE *fp`) most likely represent, according to the speaker?',
    choices: [
      'A direct integer file descriptor provided by the kernel.',
      'A `typedef` of a `struct` containing information like the file descriptor, current position, and mode.',
      'A macro that expands to a character array holding the filename.',
      'A special keyword built into the C compiler for file operations.'
    ],
    correct: 1,
    explain: 'The speaker explains that `FILE` is not a basic type, but is most likely implemented as a `typedef` for a structure that holds all the necessary information for managing the file stream[cite: 50, 51, 54].'
  },
  {
    id: 'fread-loop-termination',
    q: 'In the provided `stdio1.c` code, the program reads the file in a loop. How does the loop know when to stop?',
    choices: [
      'It stops when `fread` returns the `EOF` character.',
      'It stops when `fread` returns a negative number.',
      'It stops when the `nread` variable, which stores the return value of `fread`, is `0`.',
      'It reads a fixed number of times based on the file size.'
    ],
    correct: 2,
    explain: 'The loop is terminated by the condition `if (nread == 0) break;`. `fread` returns the number of objects successfully read, which will be zero when the end of the file is reached[cite: 95, 76].'
  },
  {
    id: 'library-vs-system-call',
    q: 'The speaker differentiates between library calls and system calls. Based on the lesson, `fopen` is an example of what?',
    choices: [
      'A direct system call that interacts with the kernel (man page section 2).',
      'A C standard library function that provides a portable interface on top of underlying system calls (man page section 3).',
      'A compiler intrinsic that is replaced with optimized assembly code.',
      'An external command that is executed in a separate process.'
    ],
    correct: 1,
    explain: 'The speaker notes that `fopen` is in section 3 of the man pages, identifying it as a C library call, not a system call (section 2)[cite: 105, 106]. [cite_start]This library function then calls the lower-level system calls of the OS[cite: 109].'
  }
];

const QUIZ_SIZE = 6;
const el = {
  container: document.getElementById('quiz-container'),
  submitBtn: document.getElementById('submit-btn'),
  retryBtn: document.getElementById('retry-btn')
};

let currentQuestions = [];
let currentIndex = 0;
let score = 0;
let answerChecked = false;

function sample(arr, k) {
  // For this version, we will not randomize, but take them in order.
  // const a = [...arr];
  // for (let i = a.length - 1; i > 0; i--) {
  //   const j = Math.floor(Math.random() * (i + 1));
  //   [a[i], a[j]] = [a[j], a[i]];
  // }
  // return a.slice(0, k);
  return arr;
}

function esc(s) {
    return s.replace(/[&<>"]/g, m => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]));
}

function startQuiz() {
  currentQuestions = sample(QUESTION_BANK, QUIZ_SIZE);
  currentIndex = 0;
  score = 0;
  answerChecked = false;
  el.submitBtn.style.display = 'inline-block';
  el.retryBtn.style.display = 'none';
  renderCurrentQuestion();
}

function renderCurrentQuestion() {
  if (currentIndex >= currentQuestions.length) {
    showResults();
    return;
  }

  answerChecked = false;
  const q = currentQuestions[currentIndex];
  let choicesHTML = '';
  q.choices.forEach((choice, i) => {
    choicesHTML += `
      <label class="answer">
        <input type="radio" name="answer" value="${i}" />
        <span>${esc(choice)}</span>
      </label>
    `;
  });

  el.container.innerHTML = `
    <div class="question-header">
      <span>Question ${currentIndex + 1} of ${currentQuestions.length}</span>
      <span>Score: ${score}</span>
    </div>
    <div class="question-body">${esc(q.q)}</div>
    <div class="answers" id="answers-container">${choicesHTML}</div>
    <div class="explanation" id="explanation-container" style="display:none;"></div>
  `;

  el.submitBtn.textContent = 'Submit Answer';
  el.submitBtn.disabled = true;

  document.querySelectorAll('input[name="answer"]').forEach(input => {
    input.addEventListener('change', () => {
      document.querySelectorAll('.answer').forEach(label => label.classList.remove('selected'));
      input.parentElement.classList.add('selected');
      el.submitBtn.disabled = false;
    });
  });
}

function handleSubmit() {
  if (answerChecked) {
    // This is the "Next Question" phase
    currentIndex++;
    renderCurrentQuestion();
  } else {
    // This is the "Submit Answer" phase
    const selectedInput = document.querySelector('input[name="answer"]:checked');
    if (!selectedInput) return;

    answerChecked = true;
    const selectedValue = parseInt(selectedInput.value, 10);
    const q = currentQuestions[currentIndex];
    const isCorrect = selectedValue === q.correct;
    
    if (isCorrect) {
      score++;
    }

    const answerLabels = document.querySelectorAll('.answer');
    answerLabels[selectedValue].classList.add(isCorrect ? 'correct' : 'wrong');
    if (!isCorrect) {
      answerLabels[q.correct].classList.add('correct');
    }

    document.querySelectorAll('input[name="answer"]').forEach(input => input.disabled = true);
    
    const explanationContainer = document.getElementById('explanation-container');
    explanationContainer.innerHTML = esc(q.explain)
  .replace(/\//g, '<strong style="color: var(--accent); font-weight: 500;"></strong>');
    explanationContainer.style.display = 'block';

    if (currentIndex < currentQuestions.length - 1) {
      el.submitBtn.textContent = 'Next Question';
    } else {
      el.submitBtn.textContent = 'Show Results';
    }
  }
}

function showResults() {
  const percentage = Math.round((score / currentQuestions.length) * 100);
  el.container.innerHTML = `
    <div id="result-container">
      <h2>Quiz Complete!</h2>
      <p style="font-size: 1.2rem;">You scored <strong>${score}</strong> out of <strong>${currentQuestions.length}</strong> (${percentage}%)</p>
    </div>
  `;
  el.submitBtn.style.display = 'none';
  el.retryBtn.style.display = 'inline-block';
}

// Event Listeners
el.submitBtn.addEventListener('click', handleSubmit);
el.retryBtn.addEventListener('click', startQuiz);

document.addEventListener('keydown', e => {
  // Prevent hotkeys from firing when typing in an input/textarea
  const targetTag = e.target.tagName.toLowerCase();
  if (targetTag === 'input' || targetTag === 'textarea') {
    return;
  }

  const key = e.key.toLowerCase();
  if (key === 'r') {
    e.preventDefault();
    el.retryBtn.click();
  }
  if (key === 'n' && !el.submitBtn.disabled && el.submitBtn.style.display !== 'none') {
    e.preventDefault();
    handleSubmit();
  }
});

// Initial load
startQuiz();
</script>
</body>
</html>
